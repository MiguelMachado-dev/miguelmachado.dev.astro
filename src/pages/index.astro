---
import BaseLayout from "../layouts/BaseLayout.astro";
import Sidebar from "../components/Sidebar.astro";
import PostCard from "../components/PostCard.astro";
import BottomNav from "../components/BottomNav.astro";
import { getCollection } from "astro:content";

// Get all blog posts sorted by date
const allPosts = (
  await getCollection("blog", ({ data }) => {
    return data.draft !== true;
  })
).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Map tags to colors
const tagColorMap: Record<string, string> = {
  astro: "blue",
  golang: "go",
  go: "go",
  typescript: "js",
  javascript: "js",
  protobuf: "proto",
  "protocol buffers": "proto",
  acessibilidade: "acessibilidade",
  eslint: "eslint",
  alexa: "alexa",
};

// SEO data for home page
const homeUrl = new URL("/", Astro.site || "https://miguelmachado.dev").href;
const homeOgImage = `https://og-image-service.miguelmachado.dev/${encodeURIComponent("Miguel Machado - Software Engineer")}.png`;
---

<BaseLayout
  title="Miguel Machado - Software Engineer"
  description="Blog sobre desenvolvimento web, backend e games. Trabalhando com TypeScript, React, Next.js, Golang, e mais."
  ogImage={homeOgImage}
  canonical={homeUrl}
>
  <div class="app-container" data-pagefind-ignore="all">
    <Sidebar />

    <main class="main-content">
      <div class="content-wrapper">
        <div class="posts-grid">
          {
            allPosts.map((post) => {
              const firstTag = post.data.tags?.[0]?.toLowerCase() || "";
              const tagColor = tagColorMap[firstTag] || "blue";

              return (
                <PostCard
                  title={post.data.title}
                  description={post.data.description}
                  slug={post.id}
                  tag={post.data.tags?.[0]?.toUpperCase()}
                  tagColor={tagColor}
                />
              );
            })
          }
        </div>
      </div>

      <BottomNav activePage="home" />
    </main>
  </div>
</BaseLayout>

<style>
  .app-container {
    display: flex;
    min-height: 100vh;
  }

  .main-content {
    flex: 1;
    margin-left: 280px;
    padding: 2rem;
    padding-bottom: 5rem;
  }

  .content-wrapper {
    max-width: 900px;
    margin: 0 auto;
  }

  .posts-grid {
    display: grid;
    gap: 1.5rem;
  }

  @media (max-width: 768px) {
    .app-container {
      flex-direction: column;
    }

    .main-content {
      margin-left: 0;
      padding: 1.5rem 1rem;
      padding-bottom: 6rem;
    }
  }
</style>
