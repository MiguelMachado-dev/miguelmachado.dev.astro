# i18n Implementation Design

## Overview

Add internationalization support to the blog with Portuguese as the default language and English as secondary. Optimized for SEO with translated URLs.

## Decisions

| Decision | Choice |
|----------|--------|
| Default language | Portuguese at root `/`, English at `/en/` |
| URL structure | Translated slugs (e.g., `/en/understanding-closures`) |
| Content scope | Full parity - all posts translated |
| File organization | Separate folders (`blog/pt/`, `blog/en/`) |
| UI translations | TypeScript objects with type safety |
| Language switcher | Both sidebar and bottom nav |
| Post linking | Matching filenames across language folders |

## URL Structure

**Portuguese (default):**
- `/` - Home page
- `/{slug}` - Blog posts
- `/search` - Search page
- `/404` - Error page

**English:**
- `/en/` - Home page
- `/en/{slug}` - Blog posts
- `/en/search` - Search page
- `/en/404` - Error page

**SEO elements per page:**
- `<html lang="pt-BR">` or `<html lang="en">`
- Hreflang tags pointing to both language versions
- `x-default` pointing to Portuguese version
- Appropriate `og:locale` meta tags

## Content Organization

```
src/content/
└── blog/
    ├── pt/
    │   ├── entendendo-closures.md
    │   └── ...
    └── en/
        ├── entendendo-closures.md  (same filename)
        └── ...
```

**Frontmatter:**
```yaml
# Portuguese version
title: Entendendo Closures em JavaScript
slug: entendendo-closures-em-javascript

# English version (same filename)
title: Understanding Closures in JavaScript
slug: understanding-closures-in-javascript
```

**Content collections:** Two separate collections (`blogPt`, `blogEn`) for simpler querying.

**Migration:** Existing posts move to `src/content/blog/pt/` with no changes.

## UI Translation System

```
src/i18n/
├── index.ts   # Helper functions
├── pt.ts      # Portuguese strings
└── en.ts      # English strings
```

**Translation structure:**
```ts
export const pt = {
  nav: {
    home: "Início",
    search: "Pesquisar",
    backToTop: "Voltar ao topo",
  },
  blog: {
    readingTime: "min de leitura",
    previousPost: "Post Anterior",
    nextPost: "Próximo Post",
    backToHome: "Voltar ao início",
  },
  search: {
    placeholder: "Pesquisar posts...",
    noResults: "Nenhum resultado encontrado",
  },
} as const;
```

**Helper functions:**
```ts
export type Lang = 'pt' | 'en';
export function getTranslations(lang: Lang) { ... }
export function getLangFromUrl(url: URL): Lang { ... }
```

## Page Routing

```
src/pages/
├── index.astro         # PT home
├── [slug].astro        # PT posts
├── search.astro        # PT search
├── 404.astro           # PT 404
└── en/
    ├── index.astro     # EN home
    ├── [slug].astro    # EN posts
    ├── search.astro    # EN search
    └── 404.astro       # EN 404
```

Shared logic in `src/lib/posts.ts` to avoid duplication.

## Language Switcher

**Component:** `src/components/LanguageSwitcher.astro`

- Accepts `translationSlug` prop for the alternate language URL
- Accepts `compact` prop for icon-only display (bottom nav)
- Full text in sidebar: "English" / "Português"
- Flag icons in bottom nav

**Placement:**
- Sidebar.astro - navigation area
- BottomNav.astro - alongside existing buttons

## SEO Implementation

**BaseLayout.astro:**
- Dynamic `lang` attribute on `<html>`
- Canonical URL for current page
- Hreflang tags for both languages
- `x-default` pointing to Portuguese
- `og:locale` meta tag

**Sitemap:** Configure for hreflang annotations.

**Pagefind:** Language-specific search indexes.

**Date formatting:** Dynamic locale based on page language.

## Migration Steps

1. Create `src/i18n/` translation system
2. Update `src/content.config.ts` for two collections
3. Move existing posts to `src/content/blog/pt/`
4. Create `src/pages/en/` route structure
5. Update components to accept `lang` prop
6. Create LanguageSwitcher component
7. Update BaseLayout with SEO tags
8. Create English content files (translation work)
